name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build app
      run: |
        xcodebuild -scheme Clipso \
          -configuration Release \
          -archivePath Clipso.xcarchive \
          archive
        
        xcodebuild -exportArchive \
          -archivePath Clipso.xcarchive \
          -exportPath . \
          -exportOptionsPlist ExportOptions.plist
    
    - name: Create DMG
      run: |
        brew install create-dmg
        create-dmg \
          --volname "Clipso" \
          --window-size 800 400 \
          --icon-size 100 \
          --app-drop-link 600 185 \
          "Clipso.dmg" \
          "Clipso.app"
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: Clipso.dmg
